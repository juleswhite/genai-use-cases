---
export interface Props {
  message: string;
  sender: 'user' | 'ai';
  timestamp?: string;
  avatar?: string;
}

const { message, sender, timestamp, avatar } = Astro.props;
const isUser = sender === 'user';
---

<div class={`flex ${isUser ? 'justify-end' : 'justify-start'} mb-4`}>
  <div class={`flex items-end space-x-2 max-w-xs lg:max-w-md ${isUser ? 'flex-row-reverse space-x-reverse' : ''}`}>
    <!-- Avatar -->
    <div class={`flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center ${
      isUser 
        ? 'bg-blue-600' 
        : 'bg-gradient-to-br from-purple-500 to-purple-600'
    }`}>
      {avatar ? (
        <img src={avatar} alt={sender} class="w-8 h-8 rounded-full" />
      ) : (
        <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          {isUser ? (
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
          ) : (
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
          )}
        </svg>
      )}
    </div>
    
    <!-- Message Bubble -->
    <div class={`relative px-4 py-3 rounded-2xl ${
      isUser 
        ? 'bg-blue-600 text-white rounded-br-sm' 
        : 'bg-white border border-slate-200 text-slate-900 rounded-bl-sm shadow-sm'
    }`}>
      <p class="text-sm leading-relaxed whitespace-pre-wrap" set:html={message}></p>
      
      {timestamp && (
        <p class={`text-xs mt-1 ${
          isUser ? 'text-blue-100' : 'text-slate-500'
        }`}>
          {timestamp}
        </p>
      )}
      
      <!-- Message tail -->
      <div class={`absolute bottom-0 ${
        isUser 
          ? 'right-0 transform translate-x-1 border-l-8 border-l-blue-600 border-b-8 border-b-transparent' 
          : 'left-0 transform -translate-x-1 border-r-8 border-r-white border-b-8 border-b-transparent'
      }`}></div>
    </div>
  </div>
</div>